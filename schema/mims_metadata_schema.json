{
    "$schema": "http://json-schema.org/draft-07/schema#",

    "type": "object",

    "propertyNames": {
        "oneOf": [
            {"const": "title"},
            {"const": "date"},
            {"const": "responsibleParties"},
            {"const": "languages"},
            {"const": "characterSet"},
            {"const": "topicCategories"},
            {"const": "spatialResolution"},
            {"const": "abstract"},
            {"const": "distributionFormats"},
            {"const": "spatialRepresentationTypes"},
            {"const": "referenceSystemName"},
            {"const": "lineageStatement"},
            {"const": "onlineResources"},
            {"const": "fileIdentifier"},
            {"const": "metadataStandardName"},
            {"const": "metadataStandardVersion"},
            {"const": "metadataLanguage"},
            {"const": "metadataCharacterSet"},
            {"const": "metadataTimestamp"},
            {"const": "purpose"},
            {"const": "scope"},
            {"const": "status"},
            {"const": "descriptiveKeywords"},
            {"const": "constraints"},
            {"const": "relatedIdentifiers"},

            {"const": "titles"},
            {"const": "publicationYear"},
            {"const": "publisher"},
            {"const": "creators"},
            {"const": "contributors"},
            {"const": "subjects"},
            {"const": "descriptions"},
            {"const": "formats"},
            {"const": "immutableResource"},
            {"const": "linkedResources"},
            {"const": "alternateIdentifiers"},
            {"const": "dates"},
            {"const": "resourceType"},
            {"const": "rightsList"}
        ]
    },

    "required": [
        "title",
        "date",
        "responsibleParties",
        "languages",
        "characterSet",
        "topicCategories",
        "spatialResolution",
        "abstract",
        "distributionFormats",
        "spatialRepresentationTypes",
        "referenceSystemName",
        "lineageStatement",
        "onlineResources",
        "fileIdentifier",
        "metadataStandardName",
        "metadataStandardVersion",
        "metadataLanguage",
        "metadataCharacterSet",
        "metadataTimestamp",
        "purpose",
        "scope",
        "status",
        "constraints"
    ],

    "mapInit": {
        "titles": "array",
        "publicationYear": "string",
        "publisher": "string",
        "creators": "array",
        "contributors": "array",
        "subjects": "array",
        "descriptions": "array",
        "formats": "array",
        "immutableResource": "object",
        "linkedResources": "array",
        "alternateIdentifiers": "array",
        "dates": "array",
        "resourceType": "object",
        "rightsList": "array"
    },

    "definitions": {
        "responsiblePartyRole": {
            "type": "string",
            "enum": [
                "resourceProvider",
                "custodian",
                "owner",
                "user",
                "distributor",
                "originator",
                "pointOfContact",
                "principalInvestigator",
                "processor",
                "publisher"
            ]
        },
        "onlineResource": {
            "type": "object",
            "properties": {
                "linkage": {"type": "string", "format": "uri"},
                "applicationProfile": {"type": "string"},
                "name": {"type": "string"},
                "description": {
                    "type": "string",
                    "enum": [
                        "download",
                        "information",
                        "offlineAccess",
                        "order",
                        "search"
                    ]
                }
            },
            "required": ["linkage"],
            "additionalProperties": false
        },
        "characterSetCode": {
            "type": "string",
            "enum": [
                "ucs2",
                "ucs4",
                "utf7",
                "utf8",
                "utf16",
                "UsASCII"
            ]
        },
        "topicCategoryCode": {
            "type": "string",
            "enum": [
                "farming",
                "biota",
                "boundaries",
                "climatologyMeteorologyAtmoshere",
                "economy",
                "elevation",
                "environment",
                "geoscientificInformation",
                "health",
                "imageryBaseMapsEarth-Cover",
                "intelligenceMilitary",
                "inlandWaters",
                "location",
                "oceans",
                "planningCadastre",
                "society",
                "structure",
                "transportation",
                "utilitiesCommunication"
            ]
        },
        "spatialRepresentationTypeCode": {
            "type": "string",
            "enum": [
                "vector",
                "grid",
                "textTable",
                "tin",
                "stereoModel",
                "video",
                "image"
            ]
        },
        "scopeCode": {
            "type": "string",
            "enum": [
                "attribute",
                "attributeType",
                "collectionHardware",
                "collectionSession",
                "dataset",
                "series",
                "nonGeographicDataset",
                "dimensionGroup",
                "feature",
                "featureType",
                "propertyType",
                "fieldSession",
                "software",
                "service",
                "model"
            ]
        },
        "progressCode": {
            "type": "string",
            "enum": [
                "completed",
                "historicalArchive",
                "obsolete",
                "onGoing",
                "planned",
                "required",
                "underDevelopment"
            ]
        },
        "keywordType": {
            "type": "string",
            "enum": [
                "discipline",
                "place",
                "stratum",
                "temporal",
                "theme"
            ]
        },
        "restrictionCode": {
            "type": "string",
            "enum": [
                "copyright",
                "patent",
                "patentPending",
                "trademark",
                "license",
                "intellectualPropertyRights",
                "restricted",
                "otherRestrictions"
            ]
        },
        "classificationCode": {
            "type": "string",
            "enum": [
                "unclassified",
                "restricted",
                "confidential",
                "secret",
                "topSecret"
            ]
        },
        "relatedIdentifierType": {
            "type": "string",
            "enum": [
                "ARK",
                "arXiv",
                "bibcode",
                "DOI",
                "EAN13",
                "EISSN",
                "Handle",
                "IGSN",
                "ISBN",
                "ISSN",
                "ISTC",
                "LISSN",
                "LSID",
                "PMID",
                "PURL",
                "UPC",
                "URL",
                "URN",
                "w3id"
            ]
        },
        "relationType": {
            "type": "string",
            "enum": [
                "IsCitedBy",
                "Cites",
                "IsSupplementTo",
                "IsSupplementedBy",
                "IsContinuedBy",
                "Continues",
                "IsDescribedBy",
                "Describes",
                "HasMetadata",
                "IsMetadataFor",
                "HasVersion",
                "IsVersionOf",
                "IsNewVersionOf",
                "IsPreviousVersionOf",
                "IsPartOf",
                "HasPart",
                "IsReferencedBy",
                "References",
                "IsDocumentedBy",
                "Documents",
                "IsCompiledBy",
                "Compiles",
                "IsVariantFormOf",
                "IsOriginalFormOf",
                "IsIdenticalTo",
                "IsReviewedBy",
                "Reviews",
                "IsDerivedFrom",
                "IsSourceOf",
                "IsRequiredBy",
                "Requires",
                "IsObsoletedBy",
                "Obsoletes"
            ]
        }
    },

    "properties": {
        "title": {
            "type": "string",
            "mapTo": {
                "target": "/titles/-",
                "value": {
                    "type": "object",
                    "properties": {
                        "title": {"type": "string"}
                    }
                }
            }
        },
        "date": {
            "type": "string",
            "format": "date",
            "mapTo": {
                "target": "/publicationYear",
                "value": {
                    "type": "string",
                    "converter": "date-to-year"
                }
            }
        },
        "responsibleParties": {
            "type": "array",
            "allOf": [
                {"contains": {"properties": {"role": {"const": "originator"}}}},
                {"contains": {"properties": {"role": {"const": "publisher"}}}},
                {"contains": {"properties": {"role": {"const": "pointOfContact"}}, "required": ["contactInfo"]}}
            ],
            "uniqueItems": true,
            "items": {
                "type": "object",
                "properties": {
                    "individualName": {"type": "string"},
                    "organizationName": {"type": "string"},
                    "positionName": {"type": "string"},
                    "contactInfo": {"type": "string"},
                    "role": {"$ref": "#/definitions/responsiblePartyRole"},
                    "onlineResource": {"$ref": "#/definitions/onlineResource"}
                },
                "required": ["individualName", "organizationName", "role"],
                "additionalProperties": false,
                "oneOf": [
                    {
                        "if": {
                            "properties": {
                                "role": {"const": "publisher"}
                            }
                        },
                        "then": {
                            "mapTo": {
                                "target": "/publisher",
                                "value": {
                                    "type": "string",
                                    "source": "organizationName"
                                }
                            }
                        },
                        "else": false
                    },
                    {
                        "if": {
                            "properties": {
                                "role": {
                                    "oneOf": [
                                        {"const": "originator"},
                                        {"const": "principalInvestigator"}
                                    ]
                                }
                            }
                        },
                        "then": {
                            "mapTo": {
                                "target": "/creators/-",
                                "value": {
                                    "type": "object",
                                    "properties": {
                                        "name": {
                                            "type": "string",
                                            "source": "individualName"
                                        },
                                        "nameIdentifiers": {
                                            "type": "array",
                                            "source": "onlineResource",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "nameIdentifier": {"type": "string", "source": "linkage"},
                                                    "nameIdentifierScheme": {"type": "string", "source": "linkage", "converter": "link-to-base-url"},
                                                    "schemeURI": {"type": "string", "source": "linkage", "converter": "link-to-base-url"}
                                                }
                                            }
                                        },
                                        "affiliations": {
                                            "type": "array",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "affiliation": {
                                                        "type": "string",
                                                        "source": ["organizationName", "positionName", "contactInfo"],
                                                        "separator": "\n"
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "else": false
                    },
                    {
                        "if": {
                            "properties": {
                                "role": {
                                    "oneOf": [
                                        {"const": "resourceProvider"},
                                        {"const": "custodian"},
                                        {"const": "owner"},
                                        {"const": "distributor"},
                                        {"const": "pointOfContact"},
                                        {"const": "processor"}
                                    ]
                                }
                            }
                        },
                        "then": {
                            "mapTo": {
                                "target": "/contributors/-",
                                "value": {
                                    "type": "object",
                                    "properties": {
                                        "contributorType": {
                                            "type": "string",
                                            "source": "role",
                                            "converter": {
                                                "resourceProvider": "HostingInstitution",
                                                "custodian": "DataManager",
                                                "owner": "RightsHolder",
                                                "distributor": "Distributor",
                                                "pointOfContact": "ContactPerson",
                                                "processor": "ProjectMember"
                                            }
                                        },
                                        "name": {
                                            "type": "string",
                                            "source": "individualName"
                                        },
                                        "nameIdentifiers": {
                                            "type": "array",
                                            "source": "onlineResource",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "nameIdentifier": {"type": "string", "source": "linkage"},
                                                    "nameIdentifierScheme": {"type": "string", "source": "linkage", "converter": "link-to-base-url"},
                                                    "schemeURI": {"type": "string", "source": "linkage", "converter": "link-to-base-url"}
                                                }
                                            }
                                        },
                                        "affiliations": {
                                            "type": "array",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "affiliation": {
                                                        "type": "string",
                                                        "source": ["organizationName", "positionName", "contactInfo"],
                                                        "separator": "\n"
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "else": false
                    }
                ]
            }
        },
        "languages": {
            "type": "array",
            "items": {"type": "string"},
            "minItems": 1,
            "uniqueItems": true
        },
        "characterSet": {
            "$ref": "#/definitions/characterSetCode"
        },
        "topicCategories": {
            "type": "array",
            "items": {"$ref": "#/definitions/topicCategoryCode"},
            "minItems": 1,
            "uniqueItems": true,
            "mapTo": {
                "target": "/subjects/-",
                "value": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "subject": {"type": "string"},
                            "subjectScheme": {"type": "string", "const": "SANS1878 Dataset Topic Category"}
                        }
                    }
                }
            }
        },
        "spatialResolution": {
            "type": "string"
        },
        "abstract": {
            "type": "string",
            "mapTo": {
                "target": "/descriptions/-",
                "value": {
                    "type": "object",
                    "properties": {
                        "description": {"type": "string"},
                        "descriptionType": {"type": "string", "const": "Abstract"}
                    }
                }
            }
        },
        "distributionFormats": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "formatName": {"type": "string"},
                    "formatVersion": {"type": "string"}
                },
                "required": ["formatName"],
                "additionalProperties": false
            },
            "minItems": 1,
            "uniqueItems": true,
            "mapTo": {
                "target": "/formats/-",
                "value": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "source": ["formatName", "formatVersion"],
                        "separator": " "
                    }
                }
            }
        },
        "spatialRepresentationTypes": {
            "type": "array",
            "items": {"$ref": "#/definitions/spatialRepresentationTypeCode"},
            "minItems": 1,
            "uniqueItems": true,
            "mapTo": {
                "target": "/subjects/-",
                "value": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "subject": {"type": "string"},
                            "subjectScheme": {"type": "string", "const": "SANS1878 Spatial Representation Type"}
                        }
                    }
                }
            }
        },
        "referenceSystemName": {
            "type": "object",
            "properties": {
                "codeSpace": {"type": "string"},
                "version": {"type": "string"}
            },
            "required": ["codeSpace"],
            "additionalProperties": false,
            "mapTo": {
                "target": "/subjects/-",
                "value": {
                    "type": "object",
                    "properties": {
                        "subject": {"type": "string", "source": ["codeSpace", "version"], "separator": " "},
                        "subjectScheme": {"type": "string", "const": "SANS1878 Reference System"}
                    }
                }
            }
        },
        "lineageStatement": {
            "type": "string",
            "mapTo": {
                "target": "/descriptions/-",
                "value": {
                    "type": "object",
                    "properties": {
                        "description": {"type": "string"},
                        "descriptionType": {"type": "string", "const": "Methods"}
                    }
                }
            }
        },
        "onlineResources": {
            "type": "array",
            "items": {
                "allOf": [
                    {"$ref": "#/definitions/onlineResource"},
                    {
                        "required": ["description"],
                        "oneOf": [
                            {
                                "if": {
                                    "properties": {
                                        "description": {"const": "download"}
                                    }
                                },
                                "then": {
                                    "mapTo": {
                                        "target": "/immutableResource",
                                        "value": {
                                            "type": "object",
                                            "properties": {
                                                "resourceURL": {"type": "string", "source": "linkage"},
                                                "resourceName": {"type": "string", "source": "name"}
                                            }
                                        }
                                    }
                                },
                                "else": false
                            },
                            {
                                "if": {
                                    "properties": {
                                        "description": {"not": {"const": "download"}}
                                    }
                                },
                                "then": {
                                    "mapTo": {
                                        "target": "/linkedResources/-",
                                        "value": {
                                            "type": "object",
                                            "properties": {
                                                "resourceURL": {"type": "string", "source": "linkage"},
                                                "resourceName": {"type": "string", "source": "name"},
                                                "linkedResourceType": {
                                                    "type": "string",
                                                    "source": "description",
                                                    "converter": {
                                                        "information": "Information",
                                                        "offlineAccess": "OfflineAccess",
                                                        "order": "ConditionalAccess",
                                                        "search": "Query"
                                                    }
                                                }
                                            }
                                        }
                                    }
                                },
                                "else": false
                            }
                        ]
                    }
                ]
            },
            "minItems": 1,
            "uniqueItems": true
        },
        "fileIdentifier": {
            "type": "string",
            "mapTo": {
                "target": "/alternateIdentifiers/-",
                "value": {
                    "type": "object",
                    "properties": {
                        "alternateIdentifier": {"type": "string"},
                        "alternateIdentifierType": {"type": "string", "const": "Local accession number"}
                    }
                }
            }
        },
        "metadataStandardName": {
            "type": "string",
            "enum": ["SANS 1878", "ISO 19115"]
        },
        "metadataStandardVersion": {
            "type": "string",
            "const": "1"
        },
        "metadataLanguage": {
            "type": "string"
        },
        "metadataCharacterSet": {
            "$ref": "#/definitions/characterSetCode"
        },
        "metadataTimestamp": {
            "type": "string",
            "format": "datetime",
            "mapTo": {
                "target": "/dates/-",
                "value": {
                    "type": "object",
                    "properties": {
                        "date": {"type": "string"},
                        "dateType": {"type": "string", "const": "Issued"}
                    }
                }
            }
        },
        "purpose": {
            "type": "string",
            "mapTo": {
                "target": "/descriptions/-",
                "value": {
                    "type": "object",
                    "properties": {
                        "description": {"type": "string"},
                        "descriptionType": {"type": "string", "const": "Other"}
                    }
                }
            }
        },
        "scope": {
            "allOf": [
                {"$ref": "#/definitions/scopeCode"},
                {"mapTo": {
                        "target": "/resourceType",
                        "value": {
                            "type": "object",
                            "properties": {
                                "resourceType": {
                                    "type": "string"
                                },
                                "resourceTypeGeneral": {
                                    "type": "string",
                                    "converter": {
                                        "attribute": "Other",
                                        "attributeType": "Other",
                                        "collectionHardware": "Other",
                                        "collectionSession": "Other",
                                        "dataset": "Dataset",
                                        "series": "Other",
                                        "nonGeographicDataset": "Other",
                                        "dimensionGroup": "Other",
                                        "feature": "Other",
                                        "featureType": "Other",
                                        "propertyType": "Other",
                                        "fieldSession": "Other",
                                        "software": "Software",
                                        "service": "Service",
                                        "model": "Model"
                                    }
                                }
                            }
                        }
                    }
                }
            ]
        },
        "status": {
            "type": "array",
            "items": {"$ref": "#/definitions/progressCode"},
            "minItems": 1,
            "uniqueItems": true,
            "mapTo": {
                "target": "/subjects/-",
                "value": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "subject": {"type": "string"},
                            "subjectScheme": {"type": "string", "const": "SANS1878 Status"}
                        }
                    }
                }
            }
        },
        "descriptiveKeywords": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "keyword": {"type": "string"},
                    "keywordType": {"$ref": "#/definitions/keywordType"}
                },
                "required": ["keyword", "keywordType"],
                "additionalProperties": false
            },
            "uniqueItems": true,
            "mapTo": {
                "target": "/subjects/-",
                "value": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "subject": {"type": "string", "source": "keyword"}
                        }
                    }
                }
            }
        },
        "constraints": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "useLimitations": {
                        "type": "array",
                        "items": {"type": "string"},
                        "uniqueItems": true,
                        "mapTo": {
                            "target": "/subjects/-",
                            "value": {
                                "type": "array",
                                "items": {
                                    "type": "object",
                                    "properties": {
                                        "subject": {"type": "string"},
                                        "subjectScheme": {"type": "string", "const": "SANS1878 Use Limitation"}
                                    }
                                }
                            }
                        }
                    },
                    "accessConstraints": {
                        "type": "array",
                        "items": {"$ref": "#/definitions/restrictionCode"},
                        "uniqueItems": true,
                        "mapTo": {
                            "target": "/subjects/-",
                            "value": {
                                "type": "array",
                                "items": {
                                    "type": "object",
                                    "properties": {
                                        "subject": {"type": "string"},
                                        "subjectScheme": {"type": "string", "const": "SANS1878 Constraint"}
                                    }
                                }
                            }
                        }
                    },
                    "useConstraints": {
                        "type": "array",
                        "items": {"$ref": "#/definitions/restrictionCode"},
                        "uniqueItems": true,
                        "mapTo": {
                            "target": "/subjects/-",
                            "value": {
                                "type": "array",
                                "items": {
                                    "type": "object",
                                    "properties": {
                                        "subject": {"type": "string"},
                                        "subjectScheme": {"type": "string", "const": "SANS1878 Constraint"}
                                    }
                                }
                            }
                        }
                    },
                    "classification": {
                        "allOf": [
                            {"$ref": "#/definitions/classificationCode"},
                            {"mapTo": {
                                "target": "/subjects/-",
                                "value": {
                                    "type": "array",
                                    "items": {
                                        "type": "object",
                                        "properties": {
                                            "subject": {"type": "string"},
                                            "subjectScheme": {"type": "string", "const": "SANS1878 Security Classification"}
                                        }
                                    }
                                }
                            }}
                        ]
                    },
                    "otherConstraints": {"type": "string"},
                    "userNote": {"type": "string"}
                },
                "required": ["otherConstraints", "userNote"],
                "additionalProperties": false
            },
            "minItems": 1,
            "maxItems": 1,
            "mapTo": {
                "target": "/rightsList/-",
                "value": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "rights": {"type": "string", "source": "userNote"},
                            "rightsURI": {"type": "string", "source": "otherConstraints"}
                        }
                    }
                }
            }
        },
        "relatedIdentifiers": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "relatedIdentifier": {"type": "string"},
                    "relatedIdentifierType": {"$ref": "#/definitions/relatedIdentifierType"},
                    "relationType": {"$ref": "#/definitions/relationType"}
                },
                "additionalProperties": false,
                "required": ["relatedIdentifier", "relatedIdentifierType", "relationType"]
            },
            "uniqueItems": true
        }
    }
}
