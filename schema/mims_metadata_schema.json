{
    "$schema": "http://json-schema.org/draft-07/schema#",

    "type": "object",

    "propertyNames": {
        "$comment": "Declares all capturable properties as well as automatically mapped properties.",
        "oneOf": [
            {"const": "title"},
            {"const": "publicationDate"},
            {"const": "responsibleParties"},
            {"const": "datasetLanguages"},
            {"const": "dataCharacterSet"},
            {"const": "topicCategories"},
            {"const": "abstract"},
            {"const": "distributionFormats"},
            {"const": "spatialRepresentationTypes"},
            {"const": "lineageStatement"},
            {"const": "onlineResources"},
            {"const": "titles"},
            {"const": "publicationYear"},
            {"const": "publisher"},
            {"const": "creators"},
            {"const": "contributors"},
            {"const": "subjects"},
            {"const": "descriptions"},
            {"const": "formats"},
            {"const": "immutableResource"},
            {"const": "linkedResources"}
        ]
    },

    "required": [
        "title",
        "publicationDate",
        "responsibleParties",
        "datasetLanguages",
        "dataCharacterSet",
        "topicCategories",
        "abstract",
        "distributionFormats",
        "spatialRepresentationTypes",
        "lineageStatement",
        "onlineResources"
    ],

    "mapInit": {
        "titles": "array",
        "publicationYear": "string",
        "publisher": "string",
        "creators": "array",
        "contributors": "array",
        "subjects": "array",
        "descriptions": "array",
        "formats": "array",
        "immutableResource": "object",
        "linkedResources": "array"
    },

    "definitions": {
        "responsiblePartyRole": {
            "type": "string",
            "enum": [
                "resourceProvider",
                "custodian",
                "owner",
                "user",
                "distributor",
                "originator",
                "pointOfContact",
                "principalInvestigator",
                "processor",
                "publisher"
            ]
        },
        "onlineResource": {
            "type": "object",
            "properties": {
                "linkage": {"type": "string", "format": "uri"},
                "applicationProfile": {"type": "string"},
                "name": {"type": "string"},
                "description": {
                    "type": "string",
                    "enum": [
                        "download",
                        "information",
                        "offlineAccess",
                        "order",
                        "search"
                    ]
                }
            },
            "required": ["linkage"],
            "additionalProperties": false
        },
        "dataCharacterSetCode": {
            "type": "string",
            "enum": [
                "ucs2",
                "ucs4",
                "utf7",
                "utf8",
                "utf16",
                "UsASCII"
            ]
        },
        "topicCategoryCode": {
            "type": "string",
            "enum": [
                "farming",
                "biota",
                "boundaries",
                "climatologyMeteorologyAtmoshere",
                "economy",
                "elevation",
                "environment",
                "geoscientificInformation",
                "health",
                "imageryBaseMapsEarth-Cover",
                "intelligenceMilitary",
                "inlandWaters",
                "location",
                "oceans",
                "planningCadastre",
                "society",
                "structure",
                "transportation",
                "utilitiesCommunication"
            ]
        },
        "spatialRepresentationTypeCode": {
            "type": "string",
            "enum": [
                "vector",
                "grid",
                "textTable",
                "tin",
                "stereoModel",
                "video",
                "image"
            ]
        }
    },

    "properties": {
        "title": {
            "type": "string",
            "mapTo": {
                "target": "/titles/-",
                "value": {
                    "type": "object",
                    "properties": {
                        "title": {"type": "string"}
                    }
                }
            }
        },
        "publicationDate": {
            "type": "string",
            "format": "date",
            "mapTo": {
                "target": "/publicationYear",
                "value": {
                    "type": "string",
                    "converter": "date-to-year"
                }
            }
        },
        "responsibleParties": {
            "type": "array",
            "allOf": [
                {"contains": {"properties": {"role": {"const": "originator"}}}},
                {"contains": {"properties": {"role": {"const": "publisher"}}}},
                {"contains": {"properties": {"role": {"const": "pointOfContact"}}, "required": ["contactInfo"]}}
            ],
            "items": {
                "type": "object",
                "properties": {
                    "individualName": {"type": "string"},
                    "organizationName": {"type": "string"},
                    "positionName": {"type": "string"},
                    "contactInfo": {"type": "string"},
                    "role": {"$ref": "#/definitions/responsiblePartyRole"},
                    "onlineResource": {"$ref": "#/definitions/onlineResource"}
                },
                "required": ["individualName", "organizationName", "role"],
                "additionalProperties": false,
                "oneOf": [
                    {
                        "if": {
                            "properties": {
                                "role": {"const": "publisher"}
                            }
                        },
                        "then": {
                            "mapTo": {
                                "target": "/publisher",
                                "value": {
                                    "type": "string",
                                    "source": "organizationName"
                                }
                            }
                        },
                        "else": false
                    },
                    {
                        "if": {
                            "properties": {
                                "role": {
                                    "oneOf": [
                                        {"const": "originator"},
                                        {"const": "principalInvestigator"}
                                    ]
                                }
                            }
                        },
                        "then": {
                            "mapTo": {
                                "target": "/creators/-",
                                "value": {
                                    "type": "object",
                                    "properties": {
                                        "name": {
                                            "type": "string",
                                            "source": "individualName"
                                        },
                                        "nameIdentifiers": {
                                            "type": "array",
                                            "source": "onlineResource",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "nameIdentifier": {"type": "string", "source": "linkage"},
                                                    "nameIdentifierScheme": {"type": "string", "source": "linkage", "converter": "link-to-base-url"},
                                                    "schemeURI": {"type": "string", "source": "linkage", "converter": "link-to-base-url"}
                                                }
                                            }
                                        },
                                        "affiliations": {
                                            "type": "array",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "affiliation": {
                                                        "type": "string",
                                                        "source": ["organizationName", "positionName", "contactInfo"],
                                                        "separator": "\n"
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "else": false
                    },
                    {
                        "if": {
                            "properties": {
                                "role": {
                                    "oneOf": [
                                        {"const": "resourceProvider"},
                                        {"const": "custodian"},
                                        {"const": "owner"},
                                        {"const": "distributor"},
                                        {"const": "pointOfContact"},
                                        {"const": "processor"}
                                    ]
                                }
                            }
                        },
                        "then": {
                            "mapTo": {
                                "target": "/contributors/-",
                                "value": {
                                    "type": "object",
                                    "properties": {
                                        "contributorType": {
                                            "type": "string",
                                            "source": "role",
                                            "converter": {
                                                "resourceProvider": "HostingInstitution",
                                                "custodian": "DataManager",
                                                "owner": "RightsHolder",
                                                "distributor": "Distributor",
                                                "pointOfContact": "ContactPerson",
                                                "processor": "ProjectMember"
                                            }
                                        },
                                        "name": {
                                            "type": "string",
                                            "source": "individualName"
                                        },
                                        "nameIdentifiers": {
                                            "type": "array",
                                            "source": "onlineResource",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "nameIdentifier": {"type": "string", "source": "linkage"},
                                                    "nameIdentifierScheme": {"type": "string", "source": "linkage", "converter": "link-to-base-url"},
                                                    "schemeURI": {"type": "string", "source": "linkage", "converter": "link-to-base-url"}
                                                }
                                            }
                                        },
                                        "affiliations": {
                                            "type": "array",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "affiliation": {
                                                        "type": "string",
                                                        "source": ["organizationName", "positionName", "contactInfo"],
                                                        "separator": "\n"
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "else": false
                    }
                ]
            }
        },
        "datasetLanguages": {
            "type": "array",
            "items": {"type": "string"},
            "minItems": 1
        },
        "dataCharacterSet": {
            "$ref": "#/definitions/dataCharacterSetCode"
        },
        "topicCategories": {
            "type": "array",
            "items": {"$ref": "#/definitions/topicCategoryCode"},
            "minItems": 1,
            "mapTo": {
                "target": "/subjects/-",
                "value": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "subject": {"type": "string"},
                            "subjectScheme": {"type": "string", "const": "SANS1878 Dataset Topic Category"}
                        }
                    }
                }
            }
        },
        "abstract": {
            "type": "string",
            "mapTo": {
                "target": "/descriptions/-",
                "value": {
                    "type": "object",
                    "properties": {
                        "description": {"type": "string"},
                        "descriptionType": {"type": "string", "const": "Abstract"}
                    }
                }
            }
        },
        "distributionFormats": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "formatName": {"type": "string"},
                    "formatVersion": {"type": "string"}
                },
                "required": ["formatName", "formatVersion"]
            },
            "minItems": 1,
            "mapTo": {
                "target": "/formats/-",
                "value": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "source": ["formatName", "formatVersion"],
                        "separator": " "
                    }
                }
            }
        },
        "spatialRepresentationTypes": {
            "type": "array",
            "items": {"$ref": "#/definitions/spatialRepresentationTypeCode"},
            "minItems": 1,
            "mapTo": {
                "target": "/subjects/-",
                "value": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "subject": {"type": "string"},
                            "subjectScheme": {"type": "string", "const": "SANS1878 Spatial Representation Type"}
                        }
                    }
                }
            }
        },
        "lineageStatement": {
            "type": "string",
            "mapTo": {
                "target": "/descriptions/-",
                "value": {
                    "type": "object",
                    "properties": {
                        "description": {"type": "string"},
                        "descriptionType": {"type": "string", "const": "Methods"}
                    }
                }
            }
        },
        "onlineResources": {
            "type": "array",
            "items": {
                "allOf": [
                    {"$ref": "#/definitions/onlineResource"},
                    {
                        "required": ["description"],
                        "oneOf": [
                            {
                                "if": {
                                    "properties": {
                                        "description": {"const": "download"}
                                    }
                                },
                                "then": {
                                    "mapTo": {
                                        "target": "/immutableResource",
                                        "value": {
                                            "type": "object",
                                            "properties": {
                                                "resourceURL": {"type": "string", "source": "linkage"},
                                                "resourceName": {"type": "string", "source": "name"}
                                            }
                                        }
                                    }
                                },
                                "else": false
                            },
                            {
                                "if": {
                                    "properties": {
                                        "description": {"not": {"const": "download"}}
                                    }
                                },
                                "then": {
                                    "mapTo": {
                                        "target": "/linkedResources/-",
                                        "value": {
                                            "type": "object",
                                            "properties": {
                                                "resourceURL": {"type": "string", "source": "linkage"},
                                                "resourceName": {"type": "string", "source": "name"},
                                                "linkedResourceType": {
                                                    "type": "string",
                                                    "source": "description",
                                                    "converter": {
                                                        "information": "Information",
                                                        "offlineAccess": "OfflineAccess",
                                                        "order": "ConditionalAccess",
                                                        "search": "Query"
                                                    }
                                                }
                                            }
                                        }
                                    }
                                },
                                "else": false
                            }
                        ]
                    }
                ]
            },
            "minItems": 1
        }
    }
}
