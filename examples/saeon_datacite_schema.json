{
    "$schema": "http://json-schema.org/draft-06/schema#",

    "definitions": {
        "personName": {
            "type": "string",
            "pattern": "^[^,]+, [^,]+$"
        },
        "contributorType": {
            "type": "string",
            "enum": [
                "ContactPerson",
                "DataCollector",
                "DataCurator",
                "DataManager",
                "Distributor",
                "Editor",
                "Funder",
                "HostingInstitution",
                "Producer",
                "ProjectLeader",
                "ProjectManager",
                "ProjectMember",
                "RegistrationAgency",
                "RegistrationAuthority",
                "RelatedPerson",
                "Researcher",
                "ResearchGroup",
                "RightsHolder",
                "Sponsor",
                "Supervisor",
                "WorkPackageLeader"
            ],
            "$comment": "excludes \"Other\""
        },
        "date": {
            "type": "string",
            "oneOf": [
                {"format": "year"},
                {"format": "yearmonth"},
                {"format": "date"},
                {"format": "datetime"},
                {"format": "year-range"},
                {"format": "yearmonth-range"},
                {"format": "date-range"},
                {"format": "datetime-range"}
            ]
        },
        "dateType": {
            "type": "string",
            "enum": [
                "Accepted",
                "Available",
                "Copyrighted",
                "Collected",
                "Created",
                "Issued",
                "Submitted",
                "Updated",
                "Valid"
            ]
        },
        "resourceTypeGeneral": {
            "type": "string",
            "enum": [
                "Audiovisual",
                "Collection",
                "Dataset",
                "Event",
                "Image",
                "InteractiveResource",
                "Model",
                "PhysicalObject",
                "Service",
                "Software",
                "Sound",
                "Text",
                "Workflow"
            ],
            "$comment": "excludes \"Other\""
        },
        "relatedIdentifierType": {
            "type": "string",
            "enum": [
                "ARK",
                "arXiv",
                "bibcode",
                "DOI",
                "EAN13",
                "EISSN",
                "Handle",
                "ISBN",
                "ISSN",
                "ISTC",
                "LISSN",
                "LSID",
                "PMID",
                "PURL",
                "UPC",
                "URL",
                "URN"
            ]
        },
        "relationType": {
            "type": "string",
            "enum": [
                "IsCitedBy",
                "Cites",
                "IsSupplementTo",
                "IsSupplementedBy",
                "IsContinuedBy",
                "Continues",
                "HasMetadata",
                "IsMetadataFor",
                "IsNewVersionOf",
                "IsPreviousVersionOf",
                "IsPartOf",
                "HasPart",
                "IsReferencedBy",
                "References",
                "IsDocumentedBy",
                "Documents",
                "IsCompiledBy",
                "Compiles",
                "IsVariantFormOf",
                "IsOriginalFormOf",
                "IsIdenticalTo",
                "IsReviewedBy",
                "Reviews",
                "IsDerivedFrom",
                "IsSourceOf"
            ]
        },
        "descriptionType": {
            "type": "string",
            "enum": [
                "Abstract",
                "Methods",
                "SeriesInformation",
                "TableOfContents",
                "Other"
            ]
        },
        "onlineResourceType": {
            "type": "string",
            "enum": [
                "download",
                "information",
                "offlineaccess",
                "order",
                "search",
                "related",
                "link",
                "metadata",
                "ethics"
            ]
        }
    },

    "type": "object",

    "properties": {
        "identifier": {
            "type": "object",
            "properties": {
                "identifier": {"type": "string", "format": "doi"},
                "identifierType": {"type": "string", "enum": ["DOI"]}
            },
            "required": ["identifier", "identifierType"],
            "task": {
                "action": "metadata_record_setname",
                "params": [{
                    "param": "name",
                    "valueRelPath": "/identifier"
                }],
                "errorAbsPath": "/identifier"
            }
        },
        "creators": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "creatorName": {"$ref": "#/definitions/personName"},
                    "nameIdentifier": {"type": "string"},
                    "nameIdentifierScheme": {"type": "string"},
                    "schemeURI": {"type": "string", "format": "uri"},
                    "affiliations": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "affiliation": {"type": "string"}
                            },
                            "required": ["affiliation"]
                        },
                        "uniqueItems": true
                    }
                },
                "required": ["creatorName"],
                "dependencies": {
                    "nameIdentifier": ["nameIdentifierScheme"]
                }
            },
            "minItems": 1,
            "uniqueItems": true
        },
        "titles": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "title": {"type": "string"},
                    "titleType": {"type": "string"}
                },
                "required": ["title"]
            },
            "minItems": 1,
            "uniqueItems": true
        },
        "publisher": {
            "type": "string"
        },
        "publicationYear": {
            "type": "string",
            "format": "year"
        },
        "subjects": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "subject": {"type": "string"},
                    "subjectScheme": {"type": "string"},
                    "schemeURI": {"type": "string", "format": "uri"}
                },
                "required": ["subject"]
            },
            "minItems": 1,
            "uniqueItems": true
        },
        "contributors": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "contributorName": {"$ref": "#/definitions/personName"},
                    "contributorType": {"$ref": "#/definitions/contributorType"},
                    "nameIdentifier": {"type": "string"},
                    "nameIdentifierScheme": {"type": "string"},
                    "schemeURI": {"type": "string", "format": "uri"},
                    "affiliations": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "affiliation": {"type": "string"}
                            },
                            "required": ["affiliation"]
                        },
                        "uniqueItems": true
                    }
                },
                "required": ["contributorName"],
                "dependencies": {
                    "nameIdentifier": ["nameIdentifierScheme"]
                }
            },
            "uniqueItems": true
        },
        "dates": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "date": {"$ref": "#/definitions/date"},
                    "dateType": {"$ref": "#/definitions/dateType"}
                },
                "required": ["date", "dateType"]
            },
            "uniqueItems": true
        },
        "language": {
            "type": "string",
            "vocabulary": "language-tags"
        },
        "resourceType": {
            "type": "string"
        },
        "resourceTypeGeneral": {
            "$ref": "#/definitions/resourceTypeGeneral"
        },
        "alternateIdentifiers": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "alternateIdentifier": {"type": "string"},
                    "alternateIdentifierType": {"type": "string"}
                },
                "required": ["alternateIdentifier", "alternateIdentifierType"]
            },
            "minItems": 1,
            "uniqueItems": true
        },
        "relatedIdentifiers": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "relatedIdentifier": {"type": "string"},
                    "relatedIdentifierType": {"$ref": "#/definitions/relatedIdentifierType"},
                    "relationType": {"$ref": "#/definitions/relationType"},
                    "relatedMetadataScheme": {"type": "string"},
                    "schemeURI": {"type": "string", "format": "uri"},
                    "schemeType": {"type": "string"}
                },
                "required": ["relatedIdentifier", "relatedIdentifierType", "relationType"],
                "$comment": "if & else are only available from draft 7",
                "if": {
                    "properties": {
                        "relationType": {"enum": ["HasMetadata", "IsMetadataFor"]}
                    }
                },
                "then": {
                    "required": ["relatedMetadataScheme", "schemeURI", "schemeType"]
                }
            },
            "uniqueItems": true
        },
        "sizes": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "size": {"type": "string"}
                },
                "required": ["size"]
            },
            "uniqueItems": true
        },
        "formats": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "format": {"type": "string"}
                },
                "required": ["format"]
            },
            "uniqueItems": true
        },
        "version": {
            "type": "string"
        },
        "rights": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "rights": {"type": "string"},
                    "rightsURI": {"type": "string", "format": "uri"}
                },
                "required": ["rights"]
            },
            "minItems": 1,
            "maxItems": 1
        },
        "description": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "description": {"type": "string"},
                    "descriptionType": {"$ref": "#/definitions/descriptionType"}
                },
                "required": ["description", "descriptionType"]
            },
            "minItems": 1,
            "uniqueItems": true
        },
        "geoLocations": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "geoLocationPoint": {"type": "string", "format": "geolocation-point"},
                    "geoLocationBox": {"type": "string", "format": "geolocation-box"},
                    "geoLocationPlace": {"type": "string"}
                }
            },
            "uniqueItems": true
        },
        "onlineResources": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "href": {"type": "string", "format": "url"},
                    "func": {"$ref": "#/definitions/onlineResourceType"},
                    "name": {"type": "string"},
                    "desc": {"type": "string"}
                },
                "required": ["href", "func"],
                "$comment": "if-then is only available from Draft 7",
                "if": {
                    "properties": {
                        "func": {"const": "download"}
                    }
                },
                "then": {
                    "task": {
                        "action": "metadata_record_seturl",
                        "params": [{
                            "param": "url",
                            "valueRelPath": "/href"
                        }],
                        "errorAbsPath": "/onlineResources"
                    }
                }
            },
            "uniqueItems": true,
            "itemCardinality": {
                "minCount": 1,
                "maxCount": 1,
                "properties": {
                    "func": {"const": "download"}
                }
            }
        }
    },

    "required": [
        "identifier",
        "creators",
        "titles",
        "publisher",
        "publicationYear",
        "subjects",
        "resourceType",
        "resourceTypeGeneral",
        "alternateIdentifiers",
        "onlineResources"
    ]
}
